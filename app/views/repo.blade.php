<table id="samples-table" role="presentation" class="table table-striped">
	<tbody>
		<tr class="row" style="background: #fff;">
			<td class="col-lg-2 col-lg-offset-2">
				<input type="text" id="vendor-filter" class="search">
			</td>
			<td class="col-lg-3">
				<input type="text" id="md5-filter" class="search">
			</td>
			<td class="col-lg-3">
				<input type="text" id="filename-filter" class="search">
			</td>
			<td class="col-lg-1">
				<input type="text" id="tag-filter" class="search">
			</td>
		</tr>
	</tbody>
	@include('template.sample', array('files' => $files))
</table>
@section('javascript')
<script type="text/javascript">
	$(function() {
		var a = function() {
			$('.template-download').each(function() {
				var t = $(this);
				var md5 = $(this).find('a[name="md5"]') ;
				var rescan = $(this).find('a[name="rescan"]');
				var vendor = $(this).find('span[name="vendor"]');
				rescan.on('click', function(e) {
					e.preventDefault();
					$.ajax({
						type: 'POST',
						url: "{{ URL::action('HomeController@rescan') }}",
						data: {md5: md5.text() },
						success: function(data) {
							vendor.text(data['VENDOR']);
							if(data['VTSCANNED'] == "Scanned") {
								if(data['VTSCORES'] == 0)
									rescan.attr("class", "label label-success");
								else
									rescan.attr("class", "label label-danger");
								rescan.text(data['VTSCORE'] + "/54");
							}
							else if(data['VTSCANNED'] == "No result" || data['VTSCANNED'] == "Error occured") {
								rescan.attr("class", "label label-warning");
								rescan.text(data['VTSCANNED']);
							}
							else {
								rescan.attr("class", "label label-info");
								rescan.text(data['VTSCANNED']);
							}

							md5.attr("href", data['VTLINK']);
						}
					});
				});
				var del = $(this).find('button[name="delete"]');
				del.on('click', function(e) {
					e.preventDefault();
					$.ajax({
						type: 'POST',
						url: "{{ URL::action('HomeController@delete') }}",
						data: {md5: md5.text()},
						success: function(data) {
							if(data == "Success") {
								t.fadeOut("fast", function() {
									t.remove();
								});
							}
						}
					});
				});
			});
}

/*$('a[name="tag"]').each(function() {*/
	var b = function() {
		$('a[name="tag"]').on('click', function() {
			$.ajax({
				type: 'GET',
				data: {tag: $(this).text()} ,
				url: "{{ URL::action('HomeController@tags') }}",
				success: function(data) {
					console.log(data);
				}
			});
		});
	}

	a(); b();

	$('.search').each(function() {
		$(this).on('keyup', function() {
			$.ajax({
				type: 'POST',
				data: {
					vendor: $('#vendor-filter').val(), 
					md5: $('#md5-filter').val(),
					filename: $('#filename-filter').val(),
					tag: $('#tag-filter').val(),
				},
				url: "{{ URL::action('HomeController@search') }}",
				success: function(data) {
					if(data.length == 0) return;
					$('table > tbody.samples-tbody').remove();
					$('#samples-table').append(data);
					a(); b();
				}
			});
		});
	});
});
</script>
@append